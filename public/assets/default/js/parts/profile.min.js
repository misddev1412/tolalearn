$(function(e){"use strict";e(".inline-reservation-calender").pDatepicker({inline:!0,altField:"#inlineCalender",initialValue:!0,calendarType:"gregorian",initialValueType:!0,autoClose:!0,altFormat:"DD MMMM YY",calendar:{gregorian:{locale:"en"}},toolbox:{calendarSwitch:{enabled:!1}},navigator:{scroll:{enabled:!1},text:{btnNextText:"<",btnPrevText:">"}},minDate:(new persianDate).subtract("day",0).valueOf(),checkDate:function(e){return function(e){var a=new persianDate(e).day(),n=(new persianDate(e).startOf("day").unix(),new persianDate(e).endOf("day").unix(),!1);for(var t in availableDays)Number(availableDays[t])===a&&(n=!0);return n}(e)},timePicker:{enabled:!1},onSelect:function(a){var n,t,i,r,s,l,o=new persianDate(a).startOf("day").unix();e("#selectedDay").val(o),n=o,t=e("#PickTimeContainer"),i=e("#PickTimeBody"),r=e("#availableTimes"),s=t.find(".loading-img"),l=t.attr("data-user-id"),e("html, body").animate({scrollTop:t.offset().top-window.innerHeight/2},600),i.addClass("d-none"),s.removeClass("d-none"),i.find(".selected_date span").text(e("#inlineCalender").val()),e.post("/users/"+l+"/availableTimes",{timestamp:n},function(e){var a="";e&&void 0!==e.times&&(Object.keys(e.times).forEach(function(n){var t=e.times[n];a+='<div class="position-relative available-times '+(t.can_reserve?"":"disabled")+'">\n<input type="checkbox" name="time[]" id="availableTime'+t.id+'" value="'+t.id+'" '+(t.can_reserve?"":"disabled")+'>\n<label for="availableTime'+t.id+'">'+t.time+"</label>\n",t.can_reserve||(a+='<span class="font-12 badge badge-danger text-white reserved-item">'+reservedLang+"</span>"),a+="</div>"}),r.html(a))}).always(function(){i.removeClass("d-none"),s.addClass("d-none")})}}),e("body").on("click","#followToggle",function(a){a.preventDefault();var n=e(this);n.addClass("loadingbar primary").prop("disabled",!0);var t="/users/"+n.attr("data-user-id")+"/follow";e.get(t,function(e){n.removeClass("loadingbar primary").prop("disabled",!1),e&&200===e.code&&(e.follow?(n.removeClass("btn-primary").addClass("btn-danger"),n.text(unFollowLang)):(n.removeClass("btn-danger").addClass("btn-primary"),n.text(followLang)))})}),e("body").on("click",".js-refresh-captcha",function(e){e.preventDefault(),refreshCaptcha()}),e("body").on("click",".js-send-message",function(a){a.preventDefault(),Swal.fire({html:e("#sendMessageModal").html(),showCancelButton:!1,showConfirmButton:!1,customClass:{content:"p-0 text-left"},onOpen:function(){refreshCaptcha()},width:"42rem"})}),e("body").on("click",".js-send-message-submit",function(a){a.preventDefault();var n=e(this);n.addClass("loadingbar primary").prop("disabled",!0);var t=n.closest("form"),i=t.attr("action"),r=t.serializeObject();e.post(i,r,function(e){e&&200===e.code?(Swal.fire({icon:"success",html:'<h3 class="font-20 text-center text-dark-blue">'+messageSuccessSentLang+"</h3>",showConfirmButton:!1}),setTimeout(function(){window.location.reload()},2e3)):Swal.fire({icon:"error",html:'<h3 class="font-20 text-center text-dark-blue">'+e.message+"</h3>",showConfirmButton:!1})}).fail(function(e){n.removeClass("loadingbar primary").prop("disabled",!1);var a=e.responseJSON;refreshCaptcha(),a&&a.errors&&Object.keys(a.errors).forEach(function(e){var n=a.errors[e],i=t.find('[name="'+e+'"]');i.addClass("is-invalid"),i.parent().find(".invalid-feedback").text(n[0])})})})});
